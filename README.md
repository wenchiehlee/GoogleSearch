## GoogleSearch.py Script Details

### Script Information
- **File**: `GoogleSearch.py`
- **Current Version**: v2.0.0 (2025-06-19)
- **Architecture**: Object-oriented with modular functions
- **Version Control**: Built-in version tracking with `__version__`, `__date__`, and `__author__` variables

### Script Features
- **Version Display**: Shows version information on startup
- **Modular Design**: Separate functions for search, download, and conversion processes
- **Error Handling**: Comprehensive error checking and graceful failure handling
- **Progress Tracking**: Real-time progress updates during batch processing
- **Multi-Query Support**: Handles multiple search queries in a single execution

### Key Functions
- `google_search()`: Performs Google Custom Search API calls
- `save_results_to_csv()`: Saves search results to CSV format
- `download_files_from_links_and_convert()`: Downloads PDFs and converts to Markdown
- `process_search_query()`: Complete processing pipeline for a single query
- `is_markitdown_valid()`: Validates Markitdown tool availability
- `main()`: Main execution function with version display

# GoogleSearch
Working space for GoogleSearch

## Version Information
- **Current Version**: v2.0.0
- **Last Updated**: 2025-06-19
- **Author**: Generated by ChatGPT based on instructions
- **License**: MIT

## Version History
| Version | Date | Changes |
|---------|------|---------|
| v1.0.0 | Initial | Basic Google search with single query support |
| v1.1.0 | - | Added PDF download functionality |
| v1.2.0 | - | Added Markitdown conversion support |
| v2.0.0 | 2025-06-19 | Multi-query support, enhanced error handling, improved structure |

## Overview
This project implements a Google Custom Search solution that searches for specific PDF documents, downloads them, and converts them to Markdown format using the Markitdown project.

## Features
- **Google Custom Search Integration**: Uses Google Custom Search JSON API to find PDF documents
- **Automated PDF Download**: Downloads PDF files from search results to a designated folder
- **PDF to Markdown Conversion**: Converts downloaded PDFs to Markdown format using Microsoft's Markitdown tool
- **CSV Results Tracking**: Maintains a comprehensive CSV file with search results and file paths
- **Multi-query Support**: Supports multiple search queries including specialized searches for financial documents and FactSet content

## Current Search Queries
1. **Financial Documents**: `"ÂæóÊ®ôÁµ±Ë®àË°® T004 -ÂÖ¨Âè∏ÂÇµ filetype:pdf"` - Searches for bond-related financial statistics documents
2. **FactSet Documents**: `"FactSet filetype:pdf"` - Searches for FactSet-related PDF documents

## File Structure
```
GoogleSearch/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ Actions.yaml        # GitHub Actions workflow configuration
‚îú‚îÄ‚îÄ README.md                   # This documentation file
‚îú‚îÄ‚îÄ GoogleSearch.py             # Main search and processing script (v2.0.0)
‚îú‚îÄ‚îÄ requirements.txt            # Python dependencies list
‚îú‚îÄ‚îÄ .env                        # Environment variables (local development)
‚îú‚îÄ‚îÄ GoogleResults.csv           # Results for financial documents search
‚îú‚îÄ‚îÄ FactSetResults.csv          # Results for FactSet search
‚îú‚îÄ‚îÄ PDF/                        # Downloaded PDF files
‚îî‚îÄ‚îÄ MD/                         # Converted Markdown files
```

## Requirements

### Prerequisites
1. **Google Custom Search API**:
   - Valid Google API key (`GOOGLE_SEARCH_API_KEY`)
   - Custom Search Engine ID (`GOOGLE_SEARCH_CSE_ID`)

2. **Markitdown Installation**:
   - Microsoft Markitdown tool must be installed and accessible in system PATH
   - Install via: `pip install markitdown`

3. **Python Dependencies**:
   - `requests`
   - `python-dotenv`
   - `csv` (built-in)
   - `os` (built-in)
   - `subprocess` (built-in)

4. **Dependencies File**:
   - `requirements.txt` containing all necessary Python packages
   - Install via: `pip install -r requirements.txt`

### Requirements.txt Contents
The `requirements.txt` file should contain:
```txt
requests>=2.31.0
python-dotenv>=1.0.0
markitdown>=0.0.1a2
```

### Environment Setup

#### Local Development
Create a `.env` file in the project root with:
```
GOOGLE_SEARCH_API_KEY=your_google_api_key_here
GOOGLE_SEARCH_CSE_ID=your_custom_search_engine_id_here
```

#### GitHub Actions (Automated Execution)
Set up the following repository secrets in GitHub:
- `GOOGLE_SEARCH_API_KEY`: Your Google API key
- `GOOGLE_SEARCH_CSE_ID`: Your Custom Search Engine ID

## GitHub Actions Automation

### Workflow Configuration
The project includes `.github/workflows/Actions.yaml` for automated execution via GitHub Actions:

**File Location**: `GoogleSearch/.github/workflows/Actions.yaml`

```yaml
name: Google Search On GitHub Action
on:
  push:
    branches:
      - main
  workflow_dispatch:
  schedule:
    - cron: "10 2 * * *"     # Runs every day at 2:10 AM UTC
```

### Automation Features
- **üîÑ Automatic Triggers**:
  - Runs on every push to the `main` branch
  - Daily scheduled execution at 2:10 AM UTC
  - Manual trigger via GitHub workflow dispatch

- **üèóÔ∏è Environment Setup**:
  - Ubuntu latest runner
  - Python 3.10 installation
  - Automatic dependency installation from `requirements.txt`
  - Markitdown tool installation

- **üîê Secure Credential Management**:
  - Uses GitHub repository secrets for API keys
  - No hardcoded credentials in the workflow

- **üìã Automated Workflow Steps**:
  1. **Repository Checkout**: Fetches latest code
  2. **Python Setup**: Configures Python 3.10 environment
  3. **Package Installation**: Installs all dependencies
  4. **Script Execution**: Runs GoogleSearch.py with environment variables
  5. **Results Commit**: Automatically commits and pushes generated files

- **üìÅ Automated File Management**:
  - Commits all CSV result files (`*.csv`)
  - Commits all downloaded PDF files (`PDF/*.pdf`)
  - Commits all converted Markdown files (`MD/*.md`)
  - Uses `github-actions[bot]` for automated commits
  - Handles missing directories gracefully

### GitHub Actions Benefits
- **üïí Scheduled Execution**: Daily automated searches ensure up-to-date results
- **üîÑ Continuous Integration**: Automatically processes new searches on code changes
- **üìä Result Tracking**: All results are automatically committed to the repository
- **üöÄ Zero-Maintenance**: Runs without manual intervention
- **üìà Audit Trail**: Complete history of automated executions in GitHub Actions logs

## CSV Output Format
The generated CSV files contain the following columns:
- **Title**: Document title from search results
- **Link**: Direct link to the PDF document
- **Snippet**: Brief description/snippet from search results
- **File**: Local file path of downloaded PDF (in PDF/ folder)
- **MD File**: Local file path of converted Markdown file (in MD/ folder)

## Process Flow
1. **Search Execution**: Performs Google Custom Search with specified query parameters
2. **Results Collection**: Gathers up to 500 search results with date restrictions (last 360 days)
3. **CSV Generation**: Creates initial CSV file with search results metadata
4. **PDF Download**: Downloads PDF files from valid links to PDF/ folder
5. **Markdown Conversion**: Converts each PDF to Markdown using Markitdown tool
6. **CSV Update**: Updates CSV file with local file paths for both PDF and MD files

## Search Parameters
- **Maximum Results**: 500 per query
- **Date Restriction**: Last 360 days
- **Language Filter**: Traditional Chinese (lang_zh-TW)
- **Country Restriction**: Taiwan (countryTW)
- **Sort Order**: By date (most recent first)

## Error Handling
- Validates Markitdown installation before processing
- Handles HTTP errors during file downloads
- Manages PDF conversion failures gracefully
- Provides progress tracking during batch processing

## Usage

### Manual Execution (Local Development)
Run the script directly on your local machine:
```bash
python GoogleSearch.py
```

### Automated Execution (GitHub Actions)
The script runs automatically via GitHub Actions in the following scenarios:

1. **üìÖ Daily Schedule**: Every day at 2:10 AM UTC
2. **üîÑ Code Push**: Automatically when changes are pushed to the `main` branch  
3. **‚ñ∂Ô∏è Manual Trigger**: Use GitHub's "Run workflow" button in the Actions tab

### Expected Output
```
GoogleSearch.py v2.0.0 - Multi-Query PDF Search and Conversion Tool
Date: 2025-06-19 | Author: Generated by ChatGPT
================================================================================

============================================================
Starting Financial Documents Search (ÂæóÊ®ôÁµ±Ë®àË°® T004)
Query: ÂæóÊ®ôÁµ±Ë®àË°® T004 -ÂÖ¨Âè∏ÂÇµ filetype:pdf
Output file: GoogleResults.csv
============================================================
Found X results for Financial Documents Search (ÂæóÊ®ôÁµ±Ë®àË°® T004)
Saved search results to GoogleResults.csv
Total rows to process for GoogleResults.csv: X
...

============================================================
Starting FactSet Documents Search
Query: FactSet filetype:pdf
Output file: FactSetResults.csv
============================================================
...

============================================================
All search queries completed!
Generated files:
- GoogleResults.csv
- FactSetResults.csv
- PDF/ (downloaded PDF files)
- MD/ (converted Markdown files)
============================================================
GoogleSearch.py v2.0.0 - Process completed successfully!
```

The script will automatically:
1. Execute both search queries (financial documents and FactSet)
2. Download all found PDF files
3. Convert them to Markdown format
4. Generate/update the respective CSV files

## Version Control Guidelines

### Updating Version Information
When modifying `GoogleSearch.py`, update the following variables at the top of the script:
```python
__version__ = "X.Y.Z"  # Semantic versioning
__date__ = "YYYY-MM-DD"  # Last modification date
__author__ = "Author Name"  # Script author/modifier
```

### Version Numbering Convention
- **Major (X.0.0)**: Breaking changes, major feature additions, architecture changes
- **Minor (X.Y.0)**: New features, significant enhancements, backward compatible
- **Patch (X.Y.Z)**: Bug fixes, minor improvements, documentation updates

### Change Documentation
1. Update the version history table in README.md
2. Update the docstring version history in GoogleSearch.py
3. Update the `__version__`, `__date__`, and `__author__` variables
4. Document changes in commit messages

## GitHub Actions Monitoring

### Workflow Status
- **üìä Actions Tab**: Monitor workflow executions in the GitHub repository's Actions tab
- **‚úÖ Success Indicators**: Green checkmarks indicate successful executions
- **‚ùå Failure Alerts**: Red X marks indicate failed executions with detailed logs
- **üìà Execution History**: Complete history of all automated runs

### Troubleshooting Common Issues

#### API Quota Exceeded
- **Symptom**: HTTP 403 errors in workflow logs
- **Solution**: Check Google API quota limits and upgrade if necessary
- **Monitoring**: Review daily API usage in Google Cloud Console

#### Markitdown Installation Failures  
- **Symptom**: "markitdown command not found" errors
- **Solution**: Verify `requirements.txt` includes all necessary dependencies
- **Check**: Ensure `pip install markitdown` step completes successfully

#### Repository Secrets Configuration
- **Required Secrets**:
  - `GOOGLE_SEARCH_API_KEY`
  - `GOOGLE_SEARCH_CSE_ID`
- **Setup Location**: Repository Settings ‚Üí Secrets and variables ‚Üí Actions

#### File Commit Issues
- **Symptom**: No new files appear after workflow execution
- **Check**: Verify workflow has write permissions to the repository
- **Solution**: Ensure `contents: write` permission is set in Actions.yaml if needed

### Workflow Customization
To modify the automation schedule, edit the cron expression in `.github/workflows/Actions.yaml`:
```yaml
schedule:
  - cron: "10 2 * * *"  # Current: Daily at 2:10 AM UTC
  # Examples:
  # - cron: "0 */6 * * *"    # Every 6 hours
  # - cron: "0 9 * * 1"     # Every Monday at 9 AM UTC
  # - cron: "30 1 1 * *"    # First day of each month at 1:30 AM UTC
```

### GitHub Actions Setup Instructions

1. **Create Workflow Directory**:
   ```bash
   mkdir -p .github/workflows
   ```

2. **Place Actions.yaml**: 
   - Copy `Actions.yaml` to `.github/workflows/Actions.yaml`
   - Ensure proper YAML formatting and indentation

3. **Configure Repository Secrets**:
   - Go to Repository Settings ‚Üí Secrets and variables ‚Üí Actions
   - Add `GOOGLE_SEARCH_API_KEY` and `GOOGLE_SEARCH_CSE_ID`

4. **Test Workflow**:
   - Push to main branch or use manual trigger
   - Monitor execution in the Actions tab

### Output Files
- `GoogleResults.csv`: Results and file paths for financial documents search
- `FactSetResults.csv`: Results and file paths for FactSet search  
- `PDF/`: Directory containing all downloaded PDF files
- `MD/`: Directory containing all converted Markdown files

## Complete Project Files

### Core Files
- **`GoogleSearch.py`** (v2.0.0): Main search and processing script
- **`README.md`**: Comprehensive project documentation
- **`.github/workflows/Actions.yaml`**: GitHub Actions workflow configuration
- **`requirements.txt`**: Python dependencies specification
- **`.env`**: Environment variables (local development only, not committed)

### Generated Files (Auto-created)
- **`GoogleResults.csv`**: Financial documents search results and file paths
- **`FactSetResults.csv`**: FactSet documents search results and file paths
- **`PDF/`**: Directory with downloaded PDF files
- **`MD/`**: Directory with converted Markdown files

### GitHub Integration
- **GitHub Secrets**: Secure storage for API credentials
- **GitHub Actions Logs**: Execution history and debugging information
- **Automated Commits**: Bot-generated commits with search results